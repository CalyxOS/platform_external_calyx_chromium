From: uazo <uazo@users.noreply.github.com>
Date: Wed, 27 Oct 2021 10:57:09 +0000
Subject: Keep empty tabs between sessions

Original License: GPL-2.0-or-later - https://spdx.org/licenses/GPL-2.0-or-later.html
License: GPL-3.0-only - https://spdx.org/licenses/GPL-3.0-only.html

Change-Id: I170ffd473248041f776dd87c3bcae825c4b6113f
---
 .../browser/tabmodel/TabPersistentStore.java  | 22 +++++++++++++------
 1 file changed, 15 insertions(+), 7 deletions(-)

diff --git a/chrome/android/java/src/org/chromium/chrome/browser/tabmodel/TabPersistentStore.java b/chrome/android/java/src/org/chromium/chrome/browser/tabmodel/TabPersistentStore.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/tabmodel/TabPersistentStore.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/tabmodel/TabPersistentStore.java
@@ -1174,19 +1174,13 @@ public class TabPersistentStore {
                 continue;
             }
 
-            if (i == activeIndex) {
-                // If any non-active NTPs have been skipped, the serialized tab model index
-                // needs to be adjusted.
-                modelInfo.index = modelInfo.ids.size();
-            } else if (shouldSkipTab(tab)) {
-                continue;
-            }
             modelInfo.ids.add(tab.getId());
             modelInfo.urls.add(tab.getUrl().getSpec());
         }
         return modelInfo;
     }
 
+<<<<<<< HEAD
     private static boolean shouldSkipTab(@NonNull Tab tab) {
         boolean isNtp = tab.isNativePage() && UrlUtilities.isNtpUrl(tab.getUrl());
         if (!isNtp) return false;
@@ -1195,6 +1189,20 @@ public class TabPersistentStore {
         return tab.getTabGroupId() == null;
     }
 
+||||||| parent of ecb7815b8e688 (Keep empty tabs between sessions)
+    private static boolean shouldSkipTab(@NonNull Tab tab) {
+        boolean isNtp = tab.isNativePage() && UrlUtilities.isNtpUrl(tab.getUrl());
+        if (!isNtp) return false;
+
+        if (ChromeFeatureList.sAndroidTabGroupStableIds.isEnabled()) {
+            // Only skip NTP tabs that are not in a tab group.
+            return tab.getTabGroupId() == null;
+        }
+        return true;
+    }
+
+=======
+>>>>>>> ecb7815b8e688 (Keep empty tabs between sessions)
     private void saveListToFile(TabModelSelectorMetadata listData) {
         if (Objects.equals(mLastSavedMetadata, listData)) return;
         // Save the index file containing the list of tabs to restore.
-- 

