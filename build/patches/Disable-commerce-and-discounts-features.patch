From: Tommy Webb <tommy@calyxinstitute.org>
Date: Tue, 20 Feb 2024 15:20:48 +0000
Subject: Disable commerce and discounts features

TODO: Update selective copying for M128!

Selectively copied from:
https://github.com/uazo/cromite/blob/0543a8a30b898b6a8c92b197b3f798ecd71dce6f/build/patches/add-browser-policy.patch

Also adapted for the upstream removal of the following flags, for which
we now behave as we did when they were disabled, prior to their removal:
- kNtpHistoryClustersModulesDiscounts
  - `f0c4460c2a3742970950378fd5d88a882c534ceb`
- kShowDiscountOnNavigation
  - `5da464c613d22ebabd3e72befd015a32f60d758d`
- kMerchantWidePromotion
  - `81089a83616b42c2d0ad6cb5213508ee5f4349d5`

License: GPL-2.0-or-later - https://spdx.org/licenses/GPL-2.0-or-later.html
Change-Id: Ie9b492700a5112e280b90652eae69735239a9d9f
---
 chrome/browser/ui/BUILD.gn                             |  6 ------
 .../views/page_action/page_action_icon_controller.cc   |  6 ------
 components/commerce/core/BUILD.gn                      |  2 --
 components/commerce/core/commerce_feature_list.cc      | 10 ++++++++++
 4 files changed, 10 insertions(+), 14 deletions(-)

diff --git a/chrome/browser/ui/BUILD.gn b/chrome/browser/ui/BUILD.gn
--- a/chrome/browser/ui/BUILD.gn
+++ b/chrome/browser/ui/BUILD.gn
@@ -3853,12 +3853,6 @@ static_library("ui") {
       "views/chrome_web_dialog_view.h",
       "views/color_provider_browser_helper.cc",
       "views/color_provider_browser_helper.h",
-      "views/commerce/discounts_bubble_dialog_view.cc",
-      "views/commerce/discounts_bubble_dialog_view.h",
-      "views/commerce/discounts_coupon_code_label_view.cc",
-      "views/commerce/discounts_coupon_code_label_view.h",
-      "views/commerce/discounts_icon_view.cc",
-      "views/commerce/discounts_icon_view.h",
       "views/commerce/price_insights_icon_view.cc",
       "views/commerce/price_insights_icon_view.h",
       "views/commerce/price_tracking_bubble_dialog_view.cc",
diff --git a/chrome/browser/ui/views/page_action/page_action_icon_controller.cc b/chrome/browser/ui/views/page_action/page_action_icon_controller.cc
--- a/chrome/browser/ui/views/page_action/page_action_icon_controller.cc
+++ b/chrome/browser/ui/views/page_action/page_action_icon_controller.cc
@@ -26,7 +26,6 @@
 #include "chrome/browser/ui/views/autofill/payments/offer_notification_icon_view.h"
 #include "chrome/browser/ui/views/autofill/payments/save_payment_icon_view.h"
 #include "chrome/browser/ui/views/autofill/payments/virtual_card_enroll_icon_view.h"
-#include "chrome/browser/ui/views/commerce/discounts_icon_view.h"
 #include "chrome/browser/ui/views/commerce/price_insights_icon_view.h"
 #include "chrome/browser/ui/views/commerce/price_tracking_icon_view.h"
 #include "chrome/browser/ui/views/commerce/product_specifications_icon_view.h"
@@ -135,11 +134,6 @@ void PageActionIconController::Init(const PageActionIconParams& params,
                       params.browser, params.icon_label_bubble_delegate,
                       params.page_action_icon_delegate));
         break;
-      case PageActionIconType::kDiscounts:
-        add_page_action_icon(type, std::make_unique<DiscountsIconView>(
-                                       params.icon_label_bubble_delegate,
-                                       params.page_action_icon_delegate));
-        break;
       case PageActionIconType::kFind:
         add_page_action_icon(
             type, std::make_unique<FindBarIcon>(
diff --git a/components/commerce/core/BUILD.gn b/components/commerce/core/BUILD.gn
--- a/components/commerce/core/BUILD.gn
+++ b/components/commerce/core/BUILD.gn
@@ -74,8 +74,6 @@ source_set("feature_list_unittests") {
 
 static_library("metrics") {
   sources = [
-    "metrics/discounts_metric_collector.cc",
-    "metrics/discounts_metric_collector.h",
     "metrics/metrics_utils.cc",
     "metrics/metrics_utils.h",
   ]
diff --git a/components/commerce/core/commerce_feature_list.cc b/components/commerce/core/commerce_feature_list.cc
--- a/components/commerce/core/commerce_feature_list.cc
+++ b/components/commerce/core/commerce_feature_list.cc
@@ -366,6 +366,16 @@ BASE_FEATURE(kCommerceDeveloper,
 
 const char kRetailCouponsWithCodeParam[] = "RetailCouponsWithCodeParam";
 
+SET_CROMITE_FEATURE_DISABLED(kCommerceHintAndroid);
+SET_CROMITE_FEATURE_DISABLED(kCommercePriceTrackingRegionLaunched);
+SET_CROMITE_FEATURE_DISABLED(kShoppingListRegionLaunched);
+
+SET_CROMITE_FEATURE_DISABLED(kParcelTracking);
+SET_CROMITE_FEATURE_DISABLED(kParcelTrackingRegionLaunched);
+
+SET_CROMITE_FEATURE_DISABLED(kEnableDiscountInfoApi);
+SET_CROMITE_FEATURE_DISABLED(kEnableDiscountInfoApiRegionLaunched);
+
 // Params use for Discount Consent v2.
 BASE_FEATURE(kDiscountConsentV2,
              "DiscountConsentV2",
-- 

