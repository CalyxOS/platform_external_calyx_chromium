From: Tommy Webb <tommy@calyxinstitute.org>
Date: Tue, 7 Jan 2025 17:13:34 +0000
Subject: fixup! bromite build utils

Change-Id: I10cf1cacebb1923cefefcb3ce9c1fb476bab8f50
---
 mojo/public/tools/mojom/mojom_parser.py | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/mojo/public/tools/mojom/mojom_parser.py b/mojo/public/tools/mojom/mojom_parser.py
--- a/mojo/public/tools/mojom/mojom_parser.py
+++ b/mojo/public/tools/mojom/mojom_parser.py
@@ -178,8 +178,8 @@ def _CollectAllowedImportsFromBuildMetadata(build_metadata_filename):
   collect(build_metadata_filename)
   return allowed_imports
 
-def _ResolveInclude(mojom_abspath, input_root_paths):
-  mojom_abspath = _ResolveRelativeImportPath(mojom_abspath, input_root_paths)
+def _ResolveInclude(mojom_abspath, imported_by, input_root_paths):
+  mojom_abspath = _ResolveRelativeImportPath(mojom_abspath, imported_by, input_root_paths)
   with codecs.open(mojom_abspath, encoding='utf-8') as f:
     src = f.read()
 
@@ -189,14 +189,14 @@ def _ResolveInclude(mojom_abspath, input_root_paths):
         include_file = re.findall(r'"([^"]*)"', i)[0]
         if include_file.startswith("../../"):
           include_file = include_file[6::]
-        lines[idx] = _ResolveInclude(include_file, input_root_paths)
+        lines[idx] = _ResolveInclude(include_file, mojom_abspath, input_root_paths)
 
   return "\n".join(lines)
 
 # multiprocessing helper.
 def _ParseAstHelper(mojom_abspath, enabled_features, input_root_paths):
   with codecs.open(mojom_abspath, encoding='utf-8') as f:
-    src = _ResolveInclude(mojom_abspath, input_root_paths)
+    src = _ResolveInclude(mojom_abspath, "_ParseAstHelper", input_root_paths)
     ast = parser.Parse(src, mojom_abspath)
     conditional_features.RemoveDisabledDefinitions(ast, enabled_features)
     return mojom_abspath, ast
-- 

