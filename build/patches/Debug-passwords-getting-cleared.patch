From: Tommy Webb <tommy@calyxinstitute.org>
Date: Mon, 13 Jan 2025 21:48:38 +0000
Subject: Debug passwords getting cleared

Issue: calyxos#2935
Issue: uazo/cromite#1735
Change-Id: Ia36d8c3029df32ef27c43bb6ced414e783866a21
---
 .../android/password_store_bridge.cc                 |  2 ++
 .../core/browser/password_store/login_database.cc    | 12 ++++++++++++
 2 files changed, 14 insertions(+)

diff --git a/chrome/browser/password_manager/android/password_store_bridge.cc b/chrome/browser/password_manager/android/password_store_bridge.cc
--- a/chrome/browser/password_manager/android/password_store_bridge.cc
+++ b/chrome/browser/password_manager/android/password_store_bridge.cc
@@ -157,6 +157,7 @@ void PasswordStoreBridge::GetAllCredentials(
 }
 
 void PasswordStoreBridge::ClearAllPasswords(JNIEnv* env) {
+  if ((true)) return;
   profile_store_->RemoveLoginsCreatedBetween(FROM_HERE, base::Time(),
                                              base::Time::Max());
   if (account_store_) {
@@ -166,6 +167,7 @@ void PasswordStoreBridge::ClearAllPasswords(JNIEnv* env) {
 }
 
 void PasswordStoreBridge::ClearAllPasswordsFromProfileStore(JNIEnv* env) {
+  if ((true)) return;
   profile_store_->RemoveLoginsCreatedBetween(FROM_HERE, base::Time(),
                                              base::Time::Max());
 }
diff --git a/components/password_manager/core/browser/password_store/login_database.cc b/components/password_manager/core/browser/password_store/login_database.cc
--- a/components/password_manager/core/browser/password_store/login_database.cc
+++ b/components/password_manager/core/browser/password_store/login_database.cc
@@ -1581,6 +1581,9 @@ PasswordStoreChangeList LoginDatabase::UpdateLogin(
 bool LoginDatabase::RemoveLogin(const PasswordForm& form,
                                 PasswordStoreChangeList* changes) {
   TRACE_EVENT0("passwords", "LoginDatabase::RemoveLogin");
+  LOG(INFO) << "RemoveLogin called, see stack trace:";
+  LOG(INFO) << base::debug::StackTrace().ToString();
+  if ((true)) return true;
   absl::Cleanup is_empty_runner = [this] { TriggerIsEmptyCb(); };
   if (changes) {
     changes->clear();
@@ -1627,6 +1630,9 @@ bool LoginDatabase::RemoveLogin(const PasswordForm& form,
 bool LoginDatabase::RemoveLoginByPrimaryKey(FormPrimaryKey primary_key,
                                             PasswordStoreChangeList* changes) {
   TRACE_EVENT0("passwords", "LoginDatabase::RemoveLoginByPrimaryKey");
+  LOG(INFO) << "RemoveLoginByPrimaryKey called, see stack trace:";
+  LOG(INFO) << base::debug::StackTrace().ToString();
+  if ((true)) return true;
   CHECK(changes);
 
   absl::Cleanup is_empty_runner = [this] { TriggerIsEmptyCb(); };
@@ -1663,6 +1669,9 @@ bool LoginDatabase::RemoveLoginsCreatedBetween(
     base::Time delete_end,
     PasswordStoreChangeList* changes) {
   TRACE_EVENT0("passwords", "LoginDatabase::RemoveLoginsCreatedBetween");
+  LOG(INFO) << "RemoveLoginsCreatedBetween called, see stack trace:";
+  LOG(INFO) << base::debug::StackTrace().ToString();
+  if ((true)) return true;
   absl::Cleanup is_empty_runner = [this] { TriggerIsEmptyCb(); };
   if (changes) {
     changes->clear();
@@ -1966,6 +1975,9 @@ bool LoginDatabase::DeleteAndRecreateDatabaseFile() {
 
 DatabaseCleanupResult LoginDatabase::DeleteUndecryptableLogins() {
   TRACE_EVENT0("passwords", "LoginDatabase::DeleteUndecryptableLogins");
+  LOG(INFO) << "DeleteUndecryptableLogins called, see stack trace:";
+  LOG(INFO) << base::debug::StackTrace().ToString();
+  if ((true)) return DatabaseCleanupResult::kSuccess;
   absl::Cleanup is_empty_runner = [this] { TriggerIsEmptyCb(); };
   // If the Keychain in MacOS or the real secret key in Linux is unavailable,
   // don't delete any logins.
-- 

